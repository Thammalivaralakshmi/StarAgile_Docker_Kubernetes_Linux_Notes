Ansible_Day 02
===================
Step 1 ‚Äî Create /etc/ansible/ directory
sudo mkdir -p /etc/ansible

Step 2 ‚Äî Create a config file
sudo nano /etc/ansible/ansible.cfg

Paste this minimal configuration:
[defaults]
inventory=/etc/ansible/hosts
host_key_checking=False

Save & exit.

Step 3 ‚Äî Create the hosts inventory file
sudo nano /etc/ansible/hosts

Add your hosts:
[dev-servers]
your-ec2-private-ip-here

[test-servers]
your-ec2-private-ip-here

Save & exit.

To verify the connection ----> ansible all -m ping ---> You should see the response from all the 4 worker nodes as "pong"

ansible all --list-hosts
ansible-inventory --list

[dev-server]
172.31.10.218

[test-server]
172.31.12.98
============================================================
SETUP Module
It will show the system info about the worker nodes
ansible all -m setup
ansible all -m setup | grep -i mem
=========
DEBUG Module
server name is
number of CPUs
total memsize
os family
package manager
=========
Ansible TAGS

Lets say in a playbook i have 15 tasks, out of these i want to execute only 2 specific tasks, in this case we will use Ansible TAGS
TAGS are used to execute or skip specific tasks
For every task, we will write a tag. And we will decide which task has to be executed/skipped based on the tags given for the tasks

ansible-playbook pb4.yml --tags user
ansible-playbook pb4.yml --skip-tags "user,maven"
========
VARIABLES
Variable is anything which holds a value
Types of variables;
Static		- defined inside the playbook
Dynamic	- not defined inside the playbook
============
LOOPS
Loops are used to reduce the number of lines in a code
=============
Writing a playbook using Adhoc Commands
SHELL
COMMAND
RAW
============
NOTIFY & HANDLERS
task 1 - install git
task 2 - install maven
task 3 - install nginx
task 4 - start nginx
task 5 - check version of git
task 6 - check version of maven

- name: Demo of notify and handlers
  hosts: all
  become: yes

  tasks:
    - name: TASK 1 - Create application config file
      copy:
        dest: /tmp/app.conf
        content: |
          APP_NAME=DevOpsDemo
          VERSION=1.0
      notify: Restart application service   # üîî NOTIFY HANDLER

    - name: TASK 2 - Install nginx
      dnf:
        name: nginx
        state: present

    - name: TASK 3 - Ensure nginx is running
      service:
        name: nginx
        state: started
        enabled: yes

    - name: TASK 5 - Print completion message
      debug:
        msg: "All main tasks executed successfully"

  handlers:
    - name: Restart application service     # üëâ This is TASK 4 (Handler)
      service:
        name: nginx
        state: restarted

Execution Flow (Very Important)
What happens when you run the playbook?

1Ô∏è‚É£ Task 1 executes
Creates /tmp/app.conf
If the file is changed, handler is notified
2Ô∏è‚É£ Task 2 executes
3Ô∏è‚É£ Task 3 executes
4Ô∏è‚É£ Task 5 executes
5Ô∏è‚É£ Handler runs at the END
Restart application service (your ‚ÄúTask 4‚Äù)













